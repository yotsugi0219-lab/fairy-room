:root{
  --bg:#0f1013; --fg:#f5f7fb; --card:#17181c; --line:#2a2d36; --muted:#93a2b8;
  /* パネル壁紙（ショップで変化） */
  --panel-bg: linear-gradient(180deg,#17181c,#121318);
  --panel-bg-size: cover;
}
*{ box-sizing:border-box; }
body{ margin:0; background:var(--bg); color:var(--fg);
  font-family:-apple-system,BlinkMacSystemFont,"Hiragino Sans","Noto Sans JP",Roboto,sans-serif;
}
.app{ max-width:720px; margin:0 auto; padding:10px 12px 24px; }

/* 部屋（高さを aspect-ratio で安定） */
.room{
  position:relative; width:100%; aspect-ratio:16/9;
  margin:8px auto 16px; border-radius:12px; overflow:hidden; background:#000;
}
.layer{ position:absolute; inset:0; width:100%; height:100%; object-fit:cover; }
.room-base{ z-index:1; } .room-sky{ z-index:2; } .room-window{ z-index:3; }
.frame-art{ z-index:4; top:14%; left:64%; width:14%; height:auto; object-fit:contain; }
.fairy{ z-index:5; }
.hidden{ display:none !important; }

/* 妖精さんの立ち位置 */
.fairy{
  position:absolute; left:50%; bottom:7%;
  transform:translateX(-50%); width:min(20%,128px); height:auto; pointer-events:auto;
}
.fairy.guest{ left:35%; bottom:7%; width:min(18%,118px); }

/* 吹き出し */
.bubble{
  position:absolute; left:50%; bottom:28%; transform:translateX(-50%);
  max-width:76%; background:rgba(0,0,0,.72); color:#fff;
  border-radius:14px; padding:10px 12px; z-index:20; backdrop-filter:blur(2px);
  box-shadow:0 2px 10px rgba(0,0,0,.25);
}
.bubble::after{
  content:""; position:absolute; left:50%; bottom:-10px; transform:translateX(-50%);
  border:10px solid transparent; border-top-color:rgba(0,0,0,.72);
}
.bubble p{ margin:0; line-height:1.3; font-size:14px; }

/* エフェクト層・Zzz・スナック */
.fx-layer{ position:absolute; inset:0; pointer-events:none; z-index:30; }
.zzz{
  position:absolute; z-index:31; left:50%; bottom:22%;
  transform:translateX(-50%); font-size:22px; opacity:0;
  animation: zzz-pop 1s ease forwards;
}
@keyframes zzz-pop{
  0%{ transform:translate(-50%,0) scale(.9); opacity:0 }
  15%{ opacity:1 }
  100%{ transform:translate(-50%,-40px) scale(1.1); opacity:0 }
}
.snack{
  position:absolute; top:-10%; font-size:28px;
  filter:drop-shadow(0 2px 2px rgba(0,0,0,.25));
  animation: snack-fall var(--t,1.1s) var(--e,ease-in) forwards,
             snack-wiggle .6s ease-in-out infinite alternate;
  will-change: transform, opacity;
}
@keyframes snack-fall{
  0%{ transform:translateY(0) rotate(0deg); opacity:0 }
  8%{ opacity:1 }
  90%{ transform:translateY(88vh) rotate(180deg) }
  100%{ transform:translateY(88vh) rotate(200deg); opacity:.9 }
}
@keyframes snack-wiggle{ from{transform:translateX(-4px)} to{transform:translateX(4px)} }
@media (prefers-reduced-motion: reduce){ .snack{ animation: snack-fall .8s linear forwards; } }

/* ドラッグ無効化（iOSのゴースト対策） */
.room img, img{
  -webkit-user-drag:none; user-select:none; -webkit-touch-callout:none; touch-action:manipulation;
}

/* パネル（下部UIの壁紙対応） */
.panel{
  margin:10px 0; padding:12px; border-radius:12px;
  background: var(--panel-bg); background-size: var(--panel-bg-size);
  box-shadow: inset 0 0 0 1px var(--line);
}
.params div{ margin:4px 0; font-size:18px; }
.commands{ display:flex; flex-wrap:wrap; justify-content:center; gap:10px; }

/* 丸ボタン */
.pill{
  background:var(--card); color:var(--fg);
  border:none; border-radius:24px; padding:12px 18px;
  margin:6px; font-size:16px; min-width:96px;
  box-shadow:0 0 0 1px var(--line) inset;
}
.pill:active{ transform:translateY(1px); }

/* ステータス行 */
.status{ display:flex; gap:10px; justify-content:center; align-items:center; flex-wrap:wrap; }

/* モーダル（ショップ） */
.modal{ position:fixed; inset:0; background:rgba(0,0,0,.45); display:flex; align-items:center; justify-content:center; z-index:50; }
.modal-body{
  width:min(92vw,560px); background:#15161a; color:#fff;
  border-radius:14px; padding:12px; box-shadow:0 10px 30px rgba(0,0,0,.4);
  border:1px solid var(--line);
}
.modal-head{ display:flex; align-items:center; justify-content:space-between; margin-bottom:8px; }
.shop-grid{ display:grid; grid-template-columns:repeat(3,1fr); gap:8px; }
.shop-item{ background:#1c1e24; border:1px solid var(--line); border-radius:10px; padding:8px; text-align:center; }
.shop-item button{ margin-top:6px; }
.note{ opacity:.7; font-size:12px; text-align:center; }

/* ぴょん（自分/ゲスト共通） */
.jump{ animation:jump .55s ease; }
@keyframes jump{
  0%{   transform:translate(-50%,0) }
  45%{  transform:translate(-50%,-40px) }
  100%{ transform:translate(-50%,0) }
}
